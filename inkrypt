#!/usr/bin/env bash
# =============================================================================
# Inkrypt - Autonomous System & SSH Penetration Testing Framework
# CLI Entry Point
# =============================================================================

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

# Colors (must be defined before any function that uses them)
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
MAGENTA='\033[0;35m'
NC='\033[0m'
BOLD='\033[1m'

# =============================================================================
# Load .env file automatically
# =============================================================================
load_env() {
    if [[ -f "$SCRIPT_DIR/.env" ]]; then
        # Export all variables from .env (skip comments and empty lines)
        set -a
        source "$SCRIPT_DIR/.env"
        set +a
    fi
}

# Auto-create .env from .env.example on first run
setup_env() {
    if [[ ! -f "$SCRIPT_DIR/.env" ]]; then
        if [[ -f "$SCRIPT_DIR/.env.example" ]]; then
            cp "$SCRIPT_DIR/.env.example" "$SCRIPT_DIR/.env"
            echo -e "${YELLOW}[!] Created .env file from .env.example${NC}"
            echo -e "${YELLOW}[!] Edit .env and set your ANTHROPIC_API_KEY before running:${NC}"
            echo -e "${CYAN}    nano .env${NC}"
            echo ""
            exit 1
        fi
    fi
}

setup_env
load_env

# =============================================================================
# Functions
# =============================================================================

show_banner() {
    # Color codes for gradient effect
    local C1='\033[38;5;197m'  # Hot pink/red
    local C2='\033[38;5;198m'  # Magenta-pink
    local C3='\033[38;5;163m'  # Magenta
    local C4='\033[38;5;128m'  # Purple
    local C5='\033[38;5;99m'   # Blue-purple
    local C6='\033[38;5;69m'   # Blue
    local C7='\033[38;5;39m'   # Cyan-blue
    local C8='\033[38;5;51m'   # Cyan
    local DIM='\033[2m'
    local RESET='\033[0m'

    echo ""
    echo -e "${DIM}${GREEN}  [sys] Establishing encrypted channel...${RESET}"
    echo -e "${DIM}${GREEN}  [sys] Loading exploit modules...${RESET}"
    echo -e "${DIM}${GREEN}  [sys] Initializing agent framework...${RESET}"
    echo ""

    # Main ASCII art with gradient per line
    echo -e "  ${C1}     ██▓ ███▄    █  ██ ▄█▀ ██▀███   ▓██   ██▓ ██▓███  ▄▄▄█████▓${RESET}"
    echo -e "  ${C2}    ▓██▒ ██ ▀█   █  ██▄█▒ ▓██ ▒ ██▒ ▒██  ██▒ ▓██▒  ██▒▓  ██▒ ▓▒${RESET}"
    echo -e "  ${C3}    ▒██▒▓██  ▀█ ██▒▓███▄░ ▓██ ░▄█ ▒  ▒██ ██░ ▓██ ░▄█ ▒▒ ▓██░ ▒░${RESET}"
    echo -e "  ${C4}    ░██░▓██▒  ▐▌██▒▓██ █▄ ▒██▀▀█▄    ░ ▐██▓░ ▒██▀▀█▄  ░ ▓██▓ ░${RESET}"
    echo -e "  ${C5}    ░██░▒██░   ▓██░▒██▒ █▄░██▓ ▒██▒  ░ ██▒▓░ ░██▓ ▒██▒  ▒██▒ ░${RESET}"
    echo -e "  ${C6}    ░▓  ░ ▒░   ▒ ▒ ▒ ▒▒ ▓▒░ ▒▓ ░▒▓░   ██▒▒▒  ░ ▒▓ ░▒▓░  ▒ ░░${RESET}"
    echo -e "  ${C7}     ▒ ░ ░░   ░ ▒░░ ░▒ ▒░  ░▒ ░ ▒░  ▓██ ░▒░    ░▒ ░ ▒░    ░${RESET}"
    echo -e "  ${C8}     ▒ ░  ░   ░ ░ ░ ░░ ░   ░░   ░   ▒ ▒ ░░     ░░   ░   ░${RESET}"
    echo -e "  ${C8}${DIM}     ░          ░ ░  ░       ░        ░ ░          ░${RESET}"
    echo -e "  ${C8}${DIM}                            ░${RESET}"
    echo ""
    echo -e "  ${DIM}${C4}  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
    echo ""
    echo -e "  ${C1}☠${RESET} ${BOLD}AUTONOMOUS SYSTEM & SSH PENETRATION TESTING FRAMEWORK${RESET}"
    echo ""
    echo -e "  ${C3}┌─${BOLD} SYSTEM ${RESET}${C3}─────────────────────────────────────────────────────────┐${RESET}"
    echo -e "  ${C3}│${RESET}  Engine    ${DIM}│${RESET} Claude Agent SDK + Temporal Orchestration            ${C3}│${RESET}"
    echo -e "  ${C3}│${RESET}  Agents    ${DIM}│${RESET} 17 Specialized AI Agents, 7 Pipelined Domains       ${C3}│${RESET}"
    echo -e "  ${C3}│${RESET}  Toolkit   ${DIM}│${RESET} Metasploit, Nmap, Hydra, Nuclei, Impacket, 30+      ${C3}│${RESET}"
    echo -e "  ${C3}│${RESET}  Status    ${DIM}│${RESET} ${C1}■${C2} ■${C3} ■${RESET}  ARMED & READY                               ${C3}│${RESET}"
    echo -e "  ${C3}└──────────────────────────────────────────────────────────────────────┘${RESET}"
    echo ""
}

show_help() {
    show_banner
    echo -e "${BOLD}USAGE:${NC}"
    echo -e "  ./inkrypt ${GREEN}start${NC} TARGET=<ip|hostname> [OPTIONS]"
    echo -e "  ./inkrypt ${GREEN}logs${NC}  ID=<workflow-id>"
    echo -e "  ./inkrypt ${GREEN}query${NC} ID=<workflow-id>"
    echo -e "  ./inkrypt ${GREEN}stop${NC}  [CLEAN=true]"
    echo -e "  ./inkrypt ${GREEN}help${NC}"
    echo ""
    echo -e "${BOLD}OPTIONS:${NC}"
    echo -e "  ${YELLOW}TARGET${NC}=<ip|hostname>     Target system IP or hostname (required)"
    echo -e "  ${YELLOW}SSH_USER${NC}=<user>          SSH username for authenticated testing"
    echo -e "  ${YELLOW}SSH_KEY${NC}=<path>           Path to SSH private key"
    echo -e "  ${YELLOW}SSH_PASS${NC}=<password>      SSH password (use with caution)"
    echo -e "  ${YELLOW}SSH_PORT${NC}=<port>          SSH port (default: 22)"
    echo -e "  ${YELLOW}CONFIG${NC}=<path>            YAML configuration file path"
    echo -e "  ${YELLOW}OUTPUT${NC}=<path>            Custom output directory"
    echo -e "  ${YELLOW}SCOPE${NC}=<cidr>             Network scope for scanning (e.g., 192.168.1.0/24)"
    echo -e "  ${YELLOW}PIPELINE_TESTING${NC}=true    Fast iteration mode (minimal prompts)"
    echo -e "  ${YELLOW}REBUILD${NC}=true             Force Docker rebuild (--no-cache)"
    echo ""
    echo -e "${BOLD}EXAMPLES:${NC}"
    echo -e "  ${CYAN}# Basic system scan${NC}"
    echo -e "  ./inkrypt start TARGET=192.168.1.100"
    echo ""
    echo -e "  ${CYAN}# SSH authenticated pentest${NC}"
    echo -e "  ./inkrypt start TARGET=10.0.0.5 SSH_USER=admin SSH_KEY=~/.ssh/id_rsa"
    echo ""
    echo -e "  ${CYAN}# Network scope scan with config${NC}"
    echo -e "  ./inkrypt start TARGET=10.0.0.1 SCOPE=10.0.0.0/24 CONFIG=configs/internal.yaml"
    echo ""
    echo -e "  ${CYAN}# Query running pentest${NC}"
    echo -e "  ./inkrypt query ID=inkrypt-abc123"
    echo ""
    echo -e "${BOLD}SETUP:${NC}"
    echo -e "  ${CYAN}1.${NC} Edit ${YELLOW}.env${NC} and set your ${YELLOW}ANTHROPIC_API_KEY${NC}"
    echo -e "  ${CYAN}2.${NC} Run ${GREEN}./inkrypt start TARGET=<ip>${NC}"
    echo ""
    echo -e "${BOLD}SECURITY TOOLS INCLUDED:${NC}"
    echo -e "  Metasploit, nmap, masscan, hydra, medusa, hashcat, john, ssh-audit,"
    echo -e "  nuclei, nikto, sqlmap, gobuster, enum4linux, crackmapexec, impacket,"
    echo -e "  LinPEAS, LinEnum, lynis, testssl.sh, searchsploit, and 20+ more"
    echo ""
}

validate_credentials() {
    if [[ -z "${ANTHROPIC_API_KEY:-}" ]] && [[ -z "${CLAUDE_CODE_OAUTH_TOKEN:-}" ]]; then
        echo -e "${RED}ERROR: ANTHROPIC_API_KEY is not set${NC}"
        echo -e ""
        echo -e "${YELLOW}Set your API key in the .env file:${NC}"
        echo -e "${CYAN}    1. Open .env:   nano .env${NC}"
        echo -e "${CYAN}    2. Replace the placeholder with your actual key:${NC}"
        echo -e "${CYAN}       ANTHROPIC_API_KEY=sk-ant-your-actual-key-here${NC}"
        echo -e "${CYAN}    3. Save and re-run ./inkrypt start ...${NC}"
        echo ""
        if [[ ! -f "$SCRIPT_DIR/.env" ]]; then
            echo -e "${YELLOW}No .env file found. Creating from template...${NC}"
            cp "$SCRIPT_DIR/.env.example" "$SCRIPT_DIR/.env" 2>/dev/null || true
            echo -e "${GREEN}Created .env - edit it now: nano .env${NC}"
        fi
        exit 1
    fi

    # Check if still using placeholder
    if [[ "${ANTHROPIC_API_KEY:-}" == "sk-ant-your-key-here" ]]; then
        echo -e "${RED}ERROR: ANTHROPIC_API_KEY still has the placeholder value${NC}"
        echo -e "${YELLOW}Edit .env and replace with your actual API key:${NC}"
        echo -e "${CYAN}    nano .env${NC}"
        exit 1
    fi
}

parse_args() {
    local command="${1:-interactive}"
    shift || true

    for arg in "$@"; do
        case "$arg" in
            TARGET=*)   INKRYPT_TARGET="${arg#TARGET=}" ;;
            SSH_USER=*) INKRYPT_SSH_USER="${arg#SSH_USER=}" ;;
            SSH_KEY=*)  INKRYPT_SSH_KEY="${arg#SSH_KEY=}" ;;
            SSH_PASS=*) INKRYPT_SSH_PASS="${arg#SSH_PASS=}" ;;
            SSH_PORT=*) INKRYPT_SSH_PORT="${arg#SSH_PORT=}" ;;
            CONFIG=*)   INKRYPT_CONFIG="${arg#CONFIG=}" ;;
            OUTPUT=*)   INKRYPT_OUTPUT="${arg#OUTPUT=}" ;;
            SCOPE=*)    INKRYPT_SCOPE="${arg#SCOPE=}" ;;
            ID=*)       INKRYPT_WORKFLOW_ID="${arg#ID=}" ;;
            PIPELINE_TESTING=*) INKRYPT_PIPELINE_TESTING="${arg#PIPELINE_TESTING=}" ;;
            REBUILD=*)  INKRYPT_REBUILD="${arg#REBUILD=}" ;;
            CLEAN=*)    INKRYPT_CLEAN="${arg#CLEAN=}" ;;
            *)          echo -e "${RED}Unknown argument: $arg${NC}"; exit 1 ;;
        esac
    done

    COMMAND="$command"
}

ensure_containers() {
    local build_flags=""
    if [[ "${INKRYPT_REBUILD:-false}" == "true" ]]; then
        build_flags="--build --no-cache"
    fi

    echo -e "${BLUE}[*] Ensuring Temporal and Worker containers are running...${NC}"
    docker compose up -d $build_flags

    echo -e "${BLUE}[*] Waiting for Temporal to be healthy...${NC}"
    local retries=0
    while ! docker compose exec -T temporal temporal operator cluster health --address localhost:7233 &>/dev/null; do
        retries=$((retries + 1))
        if [[ $retries -ge 30 ]]; then
            echo -e "${RED}ERROR: Temporal server failed to start${NC}"
            exit 1
        fi
        sleep 2
    done
    echo -e "${GREEN}[+] Temporal server is healthy${NC}"
}

cmd_start() {
    if [[ -z "${INKRYPT_TARGET:-}" ]]; then
        echo -e "${RED}ERROR: TARGET is required${NC}"
        echo -e "${YELLOW}Usage: ./inkrypt start TARGET=<ip|hostname>${NC}"
        exit 1
    fi

    validate_credentials
    show_banner

    echo -e "${GREEN}[+] Target: ${BOLD}${INKRYPT_TARGET}${NC}"
    [[ -n "${INKRYPT_SSH_USER:-}" ]] && echo -e "${GREEN}[+] SSH User: ${INKRYPT_SSH_USER}${NC}"
    [[ -n "${INKRYPT_SSH_PORT:-}" ]] && echo -e "${GREEN}[+] SSH Port: ${INKRYPT_SSH_PORT}${NC}"
    [[ -n "${INKRYPT_SCOPE:-}" ]]    && echo -e "${GREEN}[+] Scope: ${INKRYPT_SCOPE}${NC}"
    [[ -n "${INKRYPT_CONFIG:-}" ]]   && echo -e "${GREEN}[+] Config: ${INKRYPT_CONFIG}${NC}"
    echo ""

    ensure_containers

    # Build client args
    local client_args=("${INKRYPT_TARGET}")
    [[ -n "${INKRYPT_SSH_USER:-}" ]]  && client_args+=("--ssh-user" "${INKRYPT_SSH_USER}")
    [[ -n "${INKRYPT_SSH_KEY:-}" ]]   && client_args+=("--ssh-key" "${INKRYPT_SSH_KEY}")
    [[ -n "${INKRYPT_SSH_PASS:-}" ]]  && client_args+=("--ssh-pass" "${INKRYPT_SSH_PASS}")
    [[ -n "${INKRYPT_SSH_PORT:-}" ]]  && client_args+=("--ssh-port" "${INKRYPT_SSH_PORT}")
    [[ -n "${INKRYPT_CONFIG:-}" ]]    && client_args+=("--config" "${INKRYPT_CONFIG}")
    [[ -n "${INKRYPT_OUTPUT:-}" ]]    && client_args+=("--output" "${INKRYPT_OUTPUT}")
    [[ -n "${INKRYPT_SCOPE:-}" ]]     && client_args+=("--scope" "${INKRYPT_SCOPE}")
    [[ "${INKRYPT_PIPELINE_TESTING:-false}" == "true" ]] && client_args+=("--pipeline-testing")

    echo -e "${BLUE}[*] Launching pentest pipeline...${NC}"
    docker compose exec \
        -e ANTHROPIC_API_KEY="${ANTHROPIC_API_KEY:-}" \
        -e CLAUDE_CODE_OAUTH_TOKEN="${CLAUDE_CODE_OAUTH_TOKEN:-}" \
        worker node dist/temporal/client.js "${client_args[@]}"
}

cmd_query() {
    if [[ -z "${INKRYPT_WORKFLOW_ID:-}" ]]; then
        echo -e "${RED}ERROR: ID is required${NC}"
        echo -e "${YELLOW}Usage: ./inkrypt query ID=<workflow-id>${NC}"
        exit 1
    fi

    docker compose exec -T worker node dist/temporal/query.js "${INKRYPT_WORKFLOW_ID}"
}

cmd_logs() {
    if [[ -z "${INKRYPT_WORKFLOW_ID:-}" ]]; then
        echo -e "${RED}ERROR: ID is required${NC}"
        echo -e "${YELLOW}Usage: ./inkrypt logs ID=<workflow-id>${NC}"
        exit 1
    fi

    docker compose logs -f worker 2>&1 | grep -i "${INKRYPT_WORKFLOW_ID}"
}

cmd_stop() {
    echo -e "${YELLOW}[*] Stopping Inkrypt containers...${NC}"
    if [[ "${INKRYPT_CLEAN:-false}" == "true" ]]; then
        docker compose down -v --remove-orphans
        echo -e "${GREEN}[+] Containers stopped and volumes removed${NC}"
    else
        docker compose down
        echo -e "${GREEN}[+] Containers stopped (data preserved)${NC}"
    fi
}

# =============================================================================
# Interactive Mode
# =============================================================================

# Validation helpers
validate_ip_or_hostname() {
    local input="$1"
    # IPv4
    if [[ "$input" =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$ ]]; then
        local IFS='.'
        read -ra octets <<< "$input"
        for octet in "${octets[@]}"; do
            if (( octet > 255 )); then return 1; fi
        done
        return 0
    fi
    # Hostname (basic: alphanumeric, hyphens, dots)
    if [[ "$input" =~ ^[a-zA-Z0-9]([a-zA-Z0-9\.\-]*[a-zA-Z0-9])?$ ]]; then
        return 0
    fi
    return 1
}

validate_port() {
    local port="$1"
    if [[ "$port" =~ ^[0-9]+$ ]] && (( port >= 1 && port <= 65535 )); then
        return 0
    fi
    return 1
}

validate_cidr() {
    local cidr="$1"
    if [[ "$cidr" =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}$ ]]; then
        local ip="${cidr%/*}"
        local prefix="${cidr#*/}"
        if (( prefix <= 32 )); then
            validate_ip_or_hostname "$ip" && return 0
        fi
    fi
    return 1
}

cmd_interactive() {
    # Color codes matching the cyberpunk banner
    local C1='\033[38;5;197m'  # Hot pink/red
    local C3='\033[38;5;163m'  # Magenta
    local C4='\033[38;5;128m'  # Purple
    local C8='\033[38;5;51m'   # Cyan
    local DIM='\033[2m'
    local RESET='\033[0m'

    # Trap Ctrl+C for clean exit during prompts
    trap 'echo -e "\n\n  ${DIM}${C4}[sys] Aborted.${RESET}\n"; exit 130' INT

    show_banner

    echo -e "  ${C3}┌─${BOLD} TARGET CONFIGURATION ${RESET}${C3}──────────────────────────────────────────────┐${RESET}"
    echo -e "  ${C3}│${RESET}                                                                      ${C3}│${RESET}"

    # --- Target IP (required) ---
    local target=""
    while true; do
        echo -ne "  ${C3}│${RESET}  ${C8}Target IP or hostname:${RESET} "
        read -r target
        if [[ -z "$target" ]]; then
            echo -e "  ${C3}│${RESET}  ${RED}  Target is required${NC}"
            continue
        fi
        if ! validate_ip_or_hostname "$target"; then
            echo -e "  ${C3}│${RESET}  ${RED}  Invalid IP or hostname format${NC}"
            target=""
            continue
        fi
        break
    done

    # --- SSH Username (optional) ---
    echo -ne "  ${C3}│${RESET}  ${C8}SSH username ${DIM}(Enter to skip)${RESET}: "
    local ssh_user=""
    read -r ssh_user

    # --- SSH Auth (only if user provided) ---
    local ssh_key=""
    local ssh_pass=""
    if [[ -n "$ssh_user" ]]; then
        echo -ne "  ${C3}│${RESET}  ${C8}SSH key path ${DIM}(Enter for password)${RESET}: "
        read -r ssh_key
        if [[ -z "$ssh_key" ]]; then
            echo -ne "  ${C3}│${RESET}  ${C8}SSH password:${RESET} "
            read -rs ssh_pass
            echo ""
        fi
    fi

    # --- SSH Port (optional, default 22) ---
    local ssh_port=""
    while true; do
        echo -ne "  ${C3}│${RESET}  ${C8}SSH port ${DIM}[22]${RESET}: "
        read -r ssh_port
        if [[ -z "$ssh_port" ]]; then
            ssh_port=""
            break
        fi
        if ! validate_port "$ssh_port"; then
            echo -e "  ${C3}│${RESET}  ${RED}  Port must be 1-65535${NC}"
            ssh_port=""
            continue
        fi
        break
    done

    # --- Network scope CIDR (optional) ---
    local scope=""
    while true; do
        echo -ne "  ${C3}│${RESET}  ${C8}Network scope CIDR ${DIM}(Enter to skip)${RESET}: "
        read -r scope
        if [[ -z "$scope" ]]; then
            break
        fi
        if ! validate_cidr "$scope"; then
            echo -e "  ${C3}│${RESET}  ${RED}  Invalid CIDR format (e.g. 192.168.1.0/24)${NC}"
            scope=""
            continue
        fi
        break
    done

    # --- Pipeline testing mode (y/N) ---
    echo -ne "  ${C3}│${RESET}  ${C8}Pipeline testing mode? ${DIM}[y/N]${RESET}: "
    local pipeline_testing=""
    read -r pipeline_testing
    case "$pipeline_testing" in
        [yY]|[yY][eE][sS]) pipeline_testing="true" ;;
        *) pipeline_testing="" ;;
    esac

    echo -e "  ${C3}│${RESET}                                                                      ${C3}│${RESET}"
    echo -e "  ${C3}└──────────────────────────────────────────────────────────────────────┘${RESET}"
    echo ""

    # --- Confirmation summary ---
    local display_port="${ssh_port:-22}"
    local ssh_summary="—"
    if [[ -n "$ssh_user" ]]; then
        local auth_type="password"
        [[ -n "$ssh_key" ]] && auth_type="key: $ssh_key"
        ssh_summary="${ssh_user}@${target}:${display_port} (${auth_type})"
    fi
    local scope_summary="${scope:-—}"
    local mode_summary="Production"
    [[ "$pipeline_testing" == "true" ]] && mode_summary="${YELLOW}Pipeline Testing${RESET}"

    echo -e "  ${C4}┌─${BOLD} CONFIRM ${RESET}${C4}────────────────────────────────────────────────────────────┐${RESET}"
    echo -e "  ${C4}│${RESET}  Target:    ${BOLD}${target}${RESET}"
    echo -e "  ${C4}│${RESET}  SSH:       ${ssh_summary}"
    echo -e "  ${C4}│${RESET}  Scope:     ${scope_summary}"
    echo -e "  ${C4}│${RESET}  Mode:      ${mode_summary}"
    echo -e "  ${C4}└──────────────────────────────────────────────────────────────────────┘${RESET}"
    echo ""

    echo -ne "  ${C1}Launch pentest? ${DIM}[Y/n]${RESET}: "
    local confirm=""
    read -r confirm
    case "$confirm" in
        [nN]|[nN][oO])
            echo -e "\n  ${DIM}${C4}[sys] Aborted.${RESET}\n"
            exit 0
            ;;
    esac

    echo ""

    # Remove the Ctrl+C trap now that we're starting
    trap - INT

    # Set the global vars and call cmd_start
    INKRYPT_TARGET="$target"
    INKRYPT_SSH_USER="$ssh_user"
    INKRYPT_SSH_KEY="$ssh_key"
    INKRYPT_SSH_PASS="$ssh_pass"
    INKRYPT_SSH_PORT="$ssh_port"
    INKRYPT_SCOPE="$scope"
    INKRYPT_PIPELINE_TESTING="$pipeline_testing"

    cmd_start
}

# =============================================================================
# Main
# =============================================================================

COMMAND=""
INKRYPT_TARGET=""
INKRYPT_SSH_USER=""
INKRYPT_SSH_KEY=""
INKRYPT_SSH_PASS=""
INKRYPT_SSH_PORT=""
INKRYPT_CONFIG=""
INKRYPT_OUTPUT=""
INKRYPT_SCOPE=""
INKRYPT_WORKFLOW_ID=""
INKRYPT_PIPELINE_TESTING=""
INKRYPT_REBUILD=""
INKRYPT_CLEAN=""

parse_args "$@"

case "$COMMAND" in
    start)       cmd_start ;;
    interactive) cmd_interactive ;;
    query)       cmd_query ;;
    logs)        cmd_logs ;;
    stop)        cmd_stop ;;
    help)        show_help ;;
    *)
        echo -e "${RED}Unknown command: $COMMAND${NC}"
        show_help
        exit 1
        ;;
esac
